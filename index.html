<!DOCTYPE html>
<html lang="en">
<head>
        <title>N3WS by Michi</title>
        <meta name="mobile-web-app-title" content="N3WS">
        <meta name="apple-mobile-web-app-title" content="N3WS">
        <link rel="icon" type="image/png" href="icons/logo-dark-128.png">
        <link rel="icon" type="image/svg+xml" href="icons/logo-dark.svg">
        <link rel="shortcut icon" type="image/png" href="icons/logo-dark-128.png">
        <link rel="apple-touch-icon" href="icons/logo-dark-256.png">
        <link rel="apple-touch-icon" sizes="152x152" href="icons/logo-green-256.png">
        <link rel="apple-touch-icon" sizes="180x180" href="icons/logo-green-256.png">
        <link rel="apple-touch-icon" sizes="167x167" href="icons/logo-green-256.png">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
        <script src="https://unpkg.com/akar-icons-fonts"></script>
        <link rel="stylesheet" type="text/css" href="style.css"/>
        <link rel="stylesheet" type="text/css" href="https://unpkg.com/aos@2.3.1/dist/aos.css"/>
        <meta charset="UTF-8">
        <meta name="description" content="N3WS">
        <meta name="keywords" content="News">
        <meta name="author" content="Michi von Ah">
        <meta name="robots" content="index">

        <meta http-equiv="expires" content="43200">
        <meta name="theme-color" content="#2ecc71">
        <meta name="apple-mobile-web-app-status-bar-style" content="#2ecc71">
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0">
        <meta name="mobile-web-app-capable" content="yes">
        <link rel="manifest" href="manifest.json">
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Bungee&display=swap" rel="stylesheet">

</head>
<body>


      <div id="navbar">
        <h1>N3WS <var id="credit">by Michi</var></h1>
      </div>

      <div id="content">
        <div id="home">
          <div id="feed">
          </div>
        </div>
        <div id="read-later">
          <h3>Read Later</h3>
          <p>This feature is currently not available. Its coming soon with a new update. Stay tuned!</p>
          <i class="ai-face-very-sad" style="font-size: 64px;"></i>
        </div>
        <div id="settings">
          <h3>Settings</h3>
          <div id="all-feeds">
            <p>Your Feeds:</p>
            <div class="all-feed-items">
              <i class="ai-newspaper"></i>
              <p>example.com Feed</p>
              <button><i class="ai-cross"></i></button>
            </div>
            <div class="all-feed-items">
              <i class="ai-newspaper"></i>
              <p>example.com Feed</p>
              <button><i class="ai-cross"></i></button>
            </div>
            <button id="add-new-feed" onclick="addNewFeed();"><i class="ai-circle-plus-fill"></i> Add new Feed</button>
          </div>
        </div>
      </div>



      <div id="footer">
        <p>Designed with <i class="ai-heart"></i> for your mobile devices.</p>
        <p>Version 0.0.3</p>
      </div>

      <div id="navigation">
        <div class="navigation-object" onclick="showSection('home')">
          <i class="ai-home"></i>
          <p>Home</p>
        </div>
        <div class="navigation-object" onclick="showSection('read-later')" style="display:none;">
          <i class="ai-heart"></i>
          <p>Read later</p>
        </div>
        <div class="navigation-object" onclick="showSection('settings')" style="display:block;">
          <i class="ai-gear"></i>
          <p>Settings</p>
        </div>
      </div>

      <script>
      // Loading
      window.addEventListener('load', () => {
        if(window.matchMedia('(prefers-color-scheme: dark)').matches || localStorage.getItem('darkmode') == "true"){
            document.body.style.setProperty('--color', '#f6f6f6');
            document.body.style.setProperty('--background', '#181818');
            document.body.style.setProperty('--theme', '#2ecc71');
            document.body.style.setProperty('--theme2', '#27ae60');
            document.querySelector('meta[name="apple-mobile-web-app-status-bar-style"]').setAttribute("content", "#181818");
        }
        //document.getElementById("home").style.display = "block";
        loadFeed("srf");
        newFeedItem("Tutorials", "", "Click here to learn how to use this app.", "https://michivonah.notion.site/Tutorials-N3WS-by-Michi-b0fbb60a9eab4452a83351b3b3b35639")
        //newFeedItem("michivonah.ch", "https://michivonah.ch/images/img2.jpeg", "Hi, my name is Michi von Ah and I'm 16 years old. Click on the picture to read more.", "https://michivonah.ch");
        //newFeedItem("Michi's Escape Room", "https://michivonah.ch/icons/escaperoom-flyer.png", "As a final project for school, I programmed an Escape Room game. ", "https://escape.michivonah.ch");
      });

      function loadFeed(rssType){
        if(localStorage.getItem('feed1') != null){
          var feedUrl = localStorage.getItem('feed1');
        }
        // thanks to https://github.com/factmaven/xml-to-json for the xml to json api
        //var rssType = "srf";
        if(rssType == "srf"){
          let numberOfNews = 0;
          let newscount = 0;
          while (newscount < 3) {
            newscount++;
            let numberOfNews = newscount;
          $.getJSON("https://api.factmaven.com/xml-to-json/?xml=" + feedUrl, function(data) {
            var imageURLfromFeed = data.rss.channel.item[numberOfNews].description.substring(data.rss.channel.item[numberOfNews].description.indexOf('"') + 1, data.rss.channel.item[numberOfNews].description.lastIndexOf('.jpg')) + ".jpg";
            newFeedItem(data.rss.channel.item[numberOfNews].title, imageURLfromFeed, data.rss.channel.item[numberOfNews].description.replace(/<.*>/, ''), data.rss.channel.item[numberOfNews].link);
  				});

          }
        }
        else if(rssType == "google-alert"){
          var numberOfNews = 0;
          $.getJSON("https://api.factmaven.com/xml-to-json/?xml=" + feedUrl, function(data) {
            newFeedItem(data.feed.entry[numberOfNews].title.text, "", data.feed.entry[numberOfNews].content.text, data.feed.entry[numberOfNews].link.href);
  				});
        }
        else if(rssType != null){
          $.getJSON("https://api.factmaven.com/xml-to-json/?xml=" + feedUrl, function(data) {
            newFeedItem(data.rss.channel.item[numberOfNews].title, "", data.rss.channel.item[numberOfNews].description.replace(/<.*>/, ''), data.rss.channel.item[numberOfNews].link);
  				});
        }


      }

      function newFeedItem(title, image, desc, url){
        var feed = document.getElementById("feed");

        if(sessionStorage.getItem('feedCounter') == null){
          sessionStorage.setItem('feedCounter', 0);
        }
        var feedCounter = sessionStorage.getItem('feedCounter');
        feedCounter++;

        var newEntry = document.createElement('div');
        newEntry.id = "feedID" + feedCounter;
        newEntry.classList = "news-object";

        var newTitle = document.createElement('h1');
        newTitle.textContent = title;

        var newDesc = document.createElement('p');
        newDesc.textContent = desc;

        var newDescDiv = document.createElement('div');
        newDescDiv.classList = "news-description";

        if(image != null){
          var newImage = document.createElement('img');
          newImage.src = image;
        }

        var newBtn = document.createElement('button');
        newBtn.id = "feedButtonID" + feedCounter;
        var newI = document.createElement('i');
        newI.classList = "ai-heart";
        newBtn.appendChild(newI);
        newBtn.addEventListener("click", function(){
          readLater();
        });

        newEntry.addEventListener("click", function(){
          window.open(url);
        });

        newEntry.appendChild(newTitle);
        if(image != null){
          newEntry.appendChild(newImage);
        }
        newDescDiv.appendChild(newDesc);
        newDescDiv.appendChild(newBtn);
        newEntry.appendChild(newDescDiv);
        feed.appendChild(newEntry);
      }

      function readLater(){
        console.log("The read later function is coming soon.");
      }

      function addNewFeed(){
        var feedUrl = prompt("RSS Feed:", "");
        localStorage.setItem('feed1', feedUrl);
        alert("Feed successfully saved.");
        loadFeed("srf");
      }

      function showSection(sectionName){
        var section = document.getElementById(sectionName);
        document.getElementById("home").style.display = "none";
        document.getElementById("read-later").style.display = "none";
        document.getElementById("settings").style.display = "none";
        section.style.display = "block";
      }
      </script>
</body>
</html>
