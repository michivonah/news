<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="UTF-8">
        <title>N3WS by Michi</title>
        <meta name="mobile-web-app-title" content="N3WS">
        <meta name="apple-mobile-web-app-title" content="N3WS">
        <link rel="icon" type="image/png" href="icons/logo-dark-128.png">
        <link rel="icon" type="image/svg+xml" href="icons/logo-dark.svg">
        <link rel="shortcut icon" type="image/png" href="icons/logo-dark-128.png">
        <link rel="apple-touch-icon" href="icons/logo-dark-256.png">
        <link rel="apple-touch-icon" sizes="152x152" href="icons/logo-green-256.png">
        <link rel="apple-touch-icon" sizes="180x180" href="icons/logo-green-256.png">
        <link rel="apple-touch-icon" sizes="167x167" href="icons/logo-green-256.png">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
        <script src="https://unpkg.com/akar-icons-fonts"></script>
        <link rel="stylesheet" type="text/css" href="style.css"/>
        <link rel="stylesheet" type="text/css" href="https://unpkg.com/aos@2.3.1/dist/aos.css"/>
        <meta name="description" content="N3WS">
        <meta name="keywords" content="News">
        <meta name="author" content="Michi von Ah">
        <meta name="robots" content="index">

        <meta http-equiv="cache-control" content="private">
        <meta http-equiv="expires" content="43200">
        <meta name="theme-color" content="#2ecc71">
        <meta name="apple-mobile-web-app-status-bar-style" content="#2ecc71">
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0">
        <meta name="mobile-web-app-capable" content="yes">
        <link rel="manifest" href="manifest.json">
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Bungee&display=swap" rel="stylesheet">

</head>
<body>


      <div id="navbar">
        <h1>N3WS <var id="credit">by Michi</var></h1>
      </div>

      <div id="content">
        <div id="home">
          <p id="greetings">Hi!</p>
          <div id="feed">
          </div>
        </div>
        <div id="read-later">
          <h3>Read Later</h3>
          <p>This feature is currently not available. Its coming soon with a new update. Stay tuned!</p>
          <i class="ai-face-very-sad" style="font-size: 64px;"></i>
        </div>
        <div id="settings">
          <h3>Settings</h3>
          <div id="your-profile">
            <i class="ai-person"></i>
            <p>You</p>
          </div>
          <div id="all-feeds">
            <p>Your Feeds</p>
          </div>
          <button id="add-new-feed" onclick="addNewFeed();"><i class="ai-circle-plus-fill"></i> Add new Feed</button>
          <p>Number of News in your Feed</p>
          <select id="maxNewsPerSite" name="maxNewsPerSite" onchange="updateNumberOfFeedItems();">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option selected>5</option>
            <option>6</option>
            <option>8</option>
            <option>10</option>
            <option disabled>Custom</option>
          </select>
          <button onclick="loadFeed('srf');"><i class="ai-circle-plus-fill"></i> Reload Feed</button>
        </div>
      </div>

      <div id="tutorials">
        <div id="tutorialScreen1" class="tutorialscreen">
          <img src="icons/logo-green-transparent-1080.png" alt="Logo">
          <h1 style="margin-bottom: 5px;">N3WS</h1>
          <p style="margin-top: 0; text-align: center;">by Michi</p>
          <p>This is a free news app. you can connect it to your own rss feeds and easily get an overview of the articles from your favorite portals.</p>
          <button onclick="nextWelcomePage('tutorialScreen1', 'tutorialScreen4');">Get Started</button>
        </div>
        <div id="tutorialScreen4" class="tutorialscreen">
          <i class="ai-person bigicon"></i>
          <h1>Your name!</h1>
          <p>Type in here how you want to be called and then click continue.</p>
          <input id="yourNameField" type="text" placeholder="Ben">
          <button onclick="nextWelcomePage('tutorialScreen4', 'tutorialScreen2');">Continue</button>
        </div>
        <div id="tutorialScreen2" class="tutorialscreen">
          <i class="ai-rss bigicon"></i>
          <h1>Add your first RSS Feed!</h1>
          <p>Type in here and then click continue.</p>
          <input id="firstRssFeed" type="url" placeholder="RSS Feed URL">
          <button onclick="nextWelcomePage('tutorialScreen2', 'tutorialScreen3');">Continue</button>
        </div>
        <div id="tutorialScreen3" class="tutorialscreen">
          <i class="ai-circle-check bigicon"></i>
          <h1>Ready!</h1>
          <p>Everything is now set up, let's go.</p>
          <button onclick="nextWelcomePage('tutorialScreen3', 'exit');">Finish!</button>
        </div>
      </div>



      <div id="footer">
        <p>Designed with <i class="ai-heart"></i> for your mobile devices.</p>
        <p>Version 0.0.6</p>
      </div>

      <div id="navigation">
        <div class="navigation-object" onclick="showSection('home')">
          <i class="ai-home"></i>
          <p>Home</p>
        </div>
        <div class="navigation-object" onclick="showSection('read-later')" style="display:none;">
          <i class="ai-heart"></i>
          <p>Read later</p>
        </div>
        <div class="navigation-object" onclick="showSection('settings')" style="display:block;">
          <i class="ai-gear"></i>
          <p>Settings</p>
        </div>
      </div>

      <script>
      // Loading
      window.addEventListener('load', () => {
        if(window.matchMedia('(prefers-color-scheme: dark)').matches || localStorage.getItem('darkmode') == "true"){
            document.body.style.setProperty('--color', '#f6f6f6');
            document.body.style.setProperty('--background', '#181818');
            document.body.style.setProperty('--theme', '#2ecc71');
            document.body.style.setProperty('--theme2', '#27ae60');
            document.querySelector('meta[name="apple-mobile-web-app-status-bar-style"]').setAttribute("content", "#181818");
        }
        // register service worker
        if('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js');
        }
        //
        if(localStorage.getItem('NumberOfFeedItems') == null){
          localStorage.setItem('NumberOfFeedItems', 5);
        }
        // check if the app was used before
        if(localStorage.getItem('tutorials') != null){
          document.getElementById("tutorials").style.display = 'none';
        }
        // set the max of news per feed
        document.getElementById('maxNewsPerSite').value = localStorage.getItem('NumberOfFeedItems');
        //document.getElementById("home").style.display = "block";
        // load the greeting text
        greetings();
        //createJSON("type");
        // load the feed items
        addNewFeed("loadFromStorage");
        loadFeed("srf");
        newFeedItem("Tutorials", "", "Click here to learn how to use this app.", "https://michivonah.notion.site/N3WS-by-Michi-b0fbb60a9eab4452a83351b3b3b35639");
        //newFeedItem("michivonah.ch", "https://michivonah.ch/images/img2.jpeg", "Hi, my name is Michi von Ah and I'm 16 years old. Click on the picture to read more.", "https://michivonah.ch");
        //newFeedItem("Michi's Escape Room", "https://michivonah.ch/icons/escaperoom-flyer.png", "As a final project for school, I programmed an Escape Room game. ", "https://escape.michivonah.ch");

        // initialize the animate on scroll libary, thx to michalsnik.github.io/aos
        //AOS.init();
      });

      function greetings(){
        if(localStorage.getItem('name') != null){
          var name = localStorage.getItem('name');
        }
        else{
          var name = "";
        }
        var timeNow = new Date();
        if(timeNow.getHours() > 5 && timeNow.getHours() < 11){
          document.getElementById('greetings').innerHTML = "Good morning " + name + "!";
        }
        else if(timeNow.getHours() > 11 && timeNow.getHours() < 13){
          document.getElementById('greetings').innerHTML = "Good meal " + name + "!";
        }
        else if(timeNow.getHours() > 13 && timeNow.getHours() < 17){
          document.getElementById('greetings').innerHTML = "Good afternoon " + name + "!";
        }
        else if(timeNow.getHours() > 17 && timeNow.getHours() < 19){
          document.getElementById('greetings').innerHTML = "Good evening " + name + "!";
        }
        else{
          document.getElementById('greetings').innerHTML = "Good night " + name + "!";
        }
      }

      function nextWelcomePage(currentPageName, nextPageName){
        // exit = end
        if(nextPageName == "exit"){
          localStorage.setItem('tutorials', "version0_0_6");
          // yourNameField
          localStorage.setItem('name', document.getElementById("yourNameField").value);
          greetings();
          addNewFeed("setup");
          loadFeed("srf");
          document.getElementById(currentPageName).style.display = "none";
          document.getElementById("tutorials").style.display = "none";
        }
        else{
          document.getElementById(currentPageName).style.display = "none";
          document.getElementById(nextPageName).style.display = "block";
        }
      }

      function loadFeed(rssType){
        // check if the app is offline
        if(navigator.onLine == true){
          console.log("The user is online.");
        }
        else{
          console.log("The user is offline.");
          alert("Hi " + localStorage.getItem('name') + ", I think your internet connection is lost. Can you check it?");
        }
        //
        document.getElementById("feed").innerHTML = '';
        if(localStorage.getItem('feed1') != null){
          var feedUrl = localStorage.getItem('feed1');
        }
        // thanks to https://github.com/factmaven/xml-to-json for the xml to json api
        //var rssType = "srf";
        if(rssType == "srf"){
          let numberOfNews = 0;
          let newscount = 0;
          while (newscount < localStorage.getItem('NumberOfFeedItems')) {
            newscount++;
            let numberOfNews = newscount;
          $.getJSON("https://api.factmaven.com/xml-to-json/?xml=" + feedUrl, function(data) {
            var imageURLfromFeed = data.rss.channel.item[numberOfNews].description.substring(data.rss.channel.item[numberOfNews].description.indexOf('"') + 1, data.rss.channel.item[numberOfNews].description.lastIndexOf('.jpg')) + ".jpg";
            newFeedItem(data.rss.channel.item[numberOfNews].title, imageURLfromFeed, data.rss.channel.item[numberOfNews].description.replace(/<.*>/, ''), data.rss.channel.item[numberOfNews].link);
  				});

          }
        }
        else if(rssType == "google-alert"){
          var numberOfNews = 0;
          $.getJSON("https://api.factmaven.com/xml-to-json/?xml=" + feedUrl, function(data) {
            newFeedItem(data.feed.entry[numberOfNews].title.text, "", data.feed.entry[numberOfNews].content.text, data.feed.entry[numberOfNews].link.href);
  				});
        }
        else if(rssType != null){
          $.getJSON("https://api.factmaven.com/xml-to-json/?xml=" + feedUrl, function(data) {
            newFeedItem(data.rss.channel.item[numberOfNews].title, "", data.rss.channel.item[numberOfNews].description.replace(/<.*>/, ''), data.rss.channel.item[numberOfNews].link);
  				});
        }


      }

      function newFeedItem(title, image, desc, url){
        var feed = document.getElementById("feed");

        if(sessionStorage.getItem('feedCounter') == null){
          sessionStorage.setItem('feedCounter', 0);
        }
        var feedCounter = sessionStorage.getItem('feedCounter');
        feedCounter++;

        var newEntry = document.createElement('div');
        newEntry.id = "feedID" + feedCounter;
        newEntry.classList = "news-object";
        //newEntry.setAttribute('data-aos', 'fade-left');

        var newTitle = document.createElement('h1');
        newTitle.textContent = title;

        var newDesc = document.createElement('p');
        newDesc.textContent = desc;

        var newDescDiv = document.createElement('div');
        newDescDiv.classList = "news-description";

        if(image != null){
          var newImage = document.createElement('img');
          newImage.src = image;
        }

        var newBtn = document.createElement('button');
        newBtn.id = "feedButtonID" + feedCounter;
        var newI = document.createElement('i');
        if(/iPhone|iPad/i.test(navigator.userAgent)){
          newI.classList = "ai-heart news-object-i";
        }
        else{
          newI.classList = "ai-heart";
        }
        newBtn.appendChild(newI);
        newBtn.addEventListener("click", function(){
          readLater();
        });

        newEntry.addEventListener("click", function(){
          window.open(url);
        });

        newEntry.appendChild(newTitle);
        if(image != null){
          newEntry.appendChild(newImage);
        }
        newDescDiv.appendChild(newDesc);
        newDescDiv.appendChild(newBtn);
        newEntry.appendChild(newDescDiv);
        feed.appendChild(newEntry);
      }

      function readLater(){
        alert("Hey " + localStorage.getItem('name') + " the read later function is coming soon.");
        window.event.stopPropagation();
      }

      function addNewFeed(mode){
        if(mode == null){
          var feedUrl = prompt("RSS Feed:", "");
          if(feedUrl.toLowerCase().includes('https://')){
            localStorage.setItem('feed1', feedUrl);
          }
          else{
            alert("Hey " + localStorage.getItem('name') + " your RSS Feed URL is invalid.");
          }
          //alert("Feed successfully saved.");
          loadFeed("srf");
        }
        else if(mode == "setup"){
          if(document.getElementById('firstRssFeed').value.toLowerCase().includes('https://')){
            localStorage.setItem('feed1', document.getElementById('firstRssFeed').value);
          }
          else{
            alert("Hey " + localStorage.getItem('name') + " your RSS Feed URL is invalid.");
          }
        }
        else if(mode == "loadFromStorage"){
          if(localStorage.getItem('firstRssFeed') != null){
            console.log("Try to load your feed. (" + localStorage.getItem('firstRssFeed') + ")");
          }
        }

        var newFeed = document.createElement('div');
        //newFeed.id = "feedUrlId" + feedCounter;
        newFeed.classList = "all-feed-items";

        var newFeedName = document.createElement('p');
        newFeedName.textContent = localStorage.getItem('feed1');

        var newFeedI = document.createElement('i');
        newFeedI.classList = "ai-newspaper";

        var newFeedBtn = document.createElement('button');
        //newFeedBtn.id = "feedButtonID" + feedCounter;
        var newFeedI2 = document.createElement('i');
        newFeedI2.classList = "ai-cross";
        newFeedBtn.appendChild(newFeedI2);

        newFeed.appendChild(newFeedI);
        newFeed.appendChild(newFeedName);
        document.getElementById("all-feeds").appendChild(newFeed);

      }

      function updateNumberOfFeedItems(){
        localStorage.setItem('NumberOfFeedItems', parseInt(document.getElementById('maxNewsPerSite').value));
      }

      function showSection(sectionName){
        var section = document.getElementById(sectionName);
        document.getElementById("home").style.display = "none";
        document.getElementById("read-later").style.display = "none";
        document.getElementById("settings").style.display = "none";
        section.style.display = "block";
      }

      function createJSON(type){
        var storage = new Object();
        storage.name = localStorage.getItem('name');
        storage.tutorials = localStorage.getItem('NumberOfFeedItems');
        storage.NumberOfFeedItems = localStorage.getItem('NumberOfFeedItems');
        storage.NumberOfFeeds = 1;
        storage.feed1 = localStorage.getItem('feed1');
        //storage.feeds = [];
        var storageJSON = JSON.stringify(storage);
        localStorage.setItem('storage', JSON.stringify(storage));
        console.log(storage);
        console.log(storageJSON);
        console.log(localStorage.getItem('storage').name);
      }
      </script>
</body>
</html>
